/* Hello future 12Urenloop maintainer. This file was automatically
 * generated by the `make-boxxy-client.sh` script. It would be very
 * bad practice to edit this file directly. */
var boxxy = function() {
    var exports = {};
    exports.initialize = function() {
        state = {};
        state.teams = {};
        state.laps = [];
        state.maxLaps = 10;

        state.onUpdate = function(state) {};
        state.onPutState = function(state) {};
        state.onAddLap = function(state, lap) {};

        return state;
    }

    exports.putState = function(state, newState) {
        state.teams = newState.teams;
        state.laps = newState.laps;

        state.onUpdate(state);
        state.onPutState(state);
    }

    exports.addLap = function(state, lap) {
        state.laps = [lap].concat(state.laps);
        if(state.laps.length > state.maxlaps) state.laps.shift();

        state.teams[lap.team.id] = lap.team;

        state.onUpdate(state);
        state.onAddLap(state, lap);
    }
    return exports;
}();
var client = function() {
    var exports = {};
    /* Requires the `src/boxxy.js` module to be in scope as `boxxy`. The
     * `make-boxxy-client.sh` script takes care of this.
     *
     * We also require sockets.io to be in scope, this should be taken care of in
     * the HTML. */
    exports.connect = function(uri) {
        var boxxyState = boxxy.initialize();
        var socket = io.connect(uri);

        socket.on('state', function(newState) {
            boxxy.putState(boxxyState, newState);
        });

        socket.on('lap', function(lap) {
            boxxy.addLap(boxxyState, lap);
        });

        return boxxyState;
    }
    return exports;
}();
